<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup MultiPlayer Game</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <button id="playButton">Play</button>

    <script>
        var setupSocket;

        function startWebSocket() {
            setupSocket = new WebSocket(
                'ws://' + window.location.host + '/ws/setup/'
            );

            setupSocket.onmessage = function(e) {
                var data = JSON.parse(e.data);
                if (data.status === 'success') {
                    window.location.href = '/game/' + data.game_id;
                }
            };

            setupSocket.onclose = function(e) {
                console.error('Setup socket closed unexpectedly');
            };
        }

        $(document).ready(function() {
            startWebSocket();
            $('#playButton').click(function() {
                $.ajax({
                    url: '{% url "find_opponent" %}',
                    type: 'GET',
                    success: function(response) {
                        if(response.status === 'success') {
                            window.location.href = '/game/' + response.game_id;
                        } else if(response.status === 'waiting') {
                            alert('Waiting for an opponent. You will be notified once matched.');
                        }
                    },
                    error: function() {
                        alert('Error finding an opponent. Please try again.');
                    }
                });
            });
        });
    </script>
</body>
</html>
